{% extends "base.html" %}
{% block title %}{{ user.username }} — CS Community{% endblock %}

{% block content %}
<div class="row justify-content-center">
  <div class="col-lg-9">

    <!-- ── Profile Header Card ── -->
    <div class="card p-0 overflow-hidden mb-4 border-0 shadow-sm" style="border-radius:16px;">
      <!-- Banner -->
      <div style="height:160px; background:linear-gradient(135deg, var(--accent-color) 0%, #60a5fa 60%, #a78bfa 100%);">
      </div>

      <div class="px-4 pb-4" style="background-color:var(--card-bg);">
        <!-- Avatar + Edit row -->
        <div class="d-flex align-items-end justify-content-between" style="margin-top:-70px;">
          <div style="background:var(--card-bg); border-radius:50%; padding:4px; display:inline-block;">
            <img src="{{ profile_image_url(user.profile_image) }}" alt="{{ user.username }}"
              onerror="this.src='{{ url_for('static', filename='uploads/profile_pics/default_profile.png') }}'" style="width:130px; height:130px; object-fit:cover; border-radius:50%;
                        border:4px solid var(--card-bg); display:block;">
          </div>
          {% if user.id == current_user.id %}
          <a href="{{ url_for('edit_profile') }}"
            class="btn btn-outline-primary btn-sm rounded-pill px-4 fw-semibold mb-2">
            <i class="fas fa-pen me-1"></i>Edit Profile
          </a>
          {% endif %}
        </div>

        <!-- Name + Track -->
        <div class="mt-3">
          <div class="d-flex align-items-center flex-wrap gap-2 mb-1">
            <h2 class="fw-bold mb-0" style="color:var(--text-main); font-size:1.5rem;">
              {{ user.username }}
            </h2>
            {% if user.available_for_project %}
            <span class="badge rounded-pill px-3 py-2" style="background:rgba(34,197,94,0.1); color:#16a34a;
                         border:1px solid rgba(34,197,94,0.25); font-size:0.78rem;">
              <i class="fas fa-circle me-1" style="font-size:0.5rem;"></i>Open for Project
            </span>
            {% endif %}
          </div>
          <p class="mb-1" style="color:var(--text-muted); font-size:0.95rem;">
            <i class="fas fa-code-branch me-1"></i>{{ user.track or 'CS Student' }}
          </p>
          <p class="mb-3" style="color:var(--text-muted); font-size:0.82rem;">
            <i class="fas fa-envelope me-1"></i>{{ user.email }}
          </p>

          <!-- Stats row -->
          <div class="d-flex gap-4 mb-3" style="font-size:0.85rem;">
            <div class="text-center">
              <div class="fw-bold fs-5">{{ posts | length }}</div>
              <div class="text-muted small">Posts</div>
            </div>
            <div class="text-center">
              <div class="fw-bold fs-5">{{ total_likes }}</div>
              <div class="text-muted small">Likes</div>
            </div>
          </div>

          <!-- Action buttons -->
          <div class="d-flex flex-wrap gap-2">
            {% if user.cv_file %}
            <a href="{{ url_for('static', filename='uploads/cv/' + user.cv_file) }}" target="_blank"
              class="btn btn-primary btn-sm rounded-pill px-4 fw-semibold shadow-sm">
              <i class="fas fa-file-pdf me-1"></i>View Resume
            </a>
            {% endif %}

            {% if user.github_link %}
            <a href="{{ user.github_link }}" target="_blank" rel="noopener"
              class="btn btn-dark btn-sm rounded-pill px-3">
              <i class="fab fa-github me-1"></i>GitHub
            </a>
            {% endif %}

            {% if user.portfolio_link %}
            <a href="{{ user.portfolio_link }}" target="_blank" rel="noopener"
              class="btn btn-light btn-sm rounded-pill border px-3">
              <i class="fas fa-globe me-1"></i>Portfolio
            </a>
            {% endif %}

            {% if user.linkedin_link %}
            <a href="{{ user.linkedin_link }}" target="_blank" rel="noopener" class="btn btn-sm rounded-pill px-3"
              style="background:#0a66c2; color:white; border:none;">
              <i class="fab fa-linkedin me-1"></i>LinkedIn
            </a>
            {% endif %}

            {% if user.phone_number %}
            <a href="https://wa.me/{{ user.phone_number | replace('+','') | replace(' ','') }}" target="_blank"
              class="btn btn-success btn-sm rounded-pill px-3 text-white">
              <i class="fab fa-whatsapp me-1"></i>WhatsApp
            </a>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- ── Skills + Activity ── -->
    <div class="row g-3">
      <div class="col-md-4">
        <div class="card p-4 shadow-sm h-100" style="border-radius:14px;">
          <h6 class="fw-bold mb-3 pb-2 border-bottom">
            <i class="fas fa-star me-1" style="color:var(--accent-color);"></i>Top Skills
          </h6>
          <div class="d-flex flex-wrap gap-2">
            {% if user.skills %}
            {% for skill in user.skills.split(',') %}
            <span class="badge px-3 py-2" style="background:rgba(37,99,235,0.07); color:var(--accent-color);
                           border:1px solid rgba(37,99,235,0.15); border-radius:50px;
                           font-weight:500; font-size:0.8rem;">
              {{ skill.strip() }}
            </span>
            {% endfor %}
            {% else %}
            <p class="text-muted small mb-0">No skills listed yet.</p>
            {% endif %}
          </div>
        </div>
      </div>

      <div class="col-md-8">
        <div class="card p-4 shadow-sm" style="border-radius:14px;">
          <h6 class="fw-bold mb-3 pb-2 border-bottom">
            <i class="fas fa-clock-rotate-left me-1" style="color:var(--accent-color);"></i>
            Recent Activity
          </h6>
          {% for post in posts %}
          <div class="mb-3 {% if not loop.last %}border-bottom pb-3{% endif %}">
            <h6 class="fw-semibold mb-1" style="font-size:0.9rem;">
              <a href="{{ url_for('post_detail', post_id=post.id) }}" class="text-decoration-none"
                style="color:var(--text-main);">
                {{ post.title }}
              </a>
            </h6>
            <div class="d-flex align-items-center gap-3" style="font-size:0.78rem; color:var(--text-muted);">
              <span><i class="fas fa-calendar me-1"></i>{{ post.date.strftime('%B %Y') }}</span>
              <span><i class="far fa-thumbs-up me-1"></i>{{ post.likes_count or 0 }}</span>
            </div>
          </div>
          {% else %}
          <div class="text-center py-4">
            <i class="fas fa-pen-to-square text-muted mb-2" style="font-size:2rem; opacity:0.3;"></i>
            <p class="text-muted small mb-0">No posts yet.</p>
          </div>
          {% endfor %}
        </div>
      </div>
    </div>

  </div>
</div>
{% endblock %}